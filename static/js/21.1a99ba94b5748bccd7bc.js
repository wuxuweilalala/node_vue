webpackJsonp([21],{KRzv:function(e,t){},XSTS:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Gu7T"),n=i.n(a),o=i("Dd8w"),s=i.n(o),r=(i("/5sW"),i("NYxO")),c=i("tr5R"),h=i("SSTz"),d=i("yrGF"),l=(i("/IQK"),i("siEq")),u=(i("wtEF"),{name:"PreviewPages",mixins:[d.a],components:{Loading:c.a,LoadingRotating:h.a},data:function(){return{isMobileLayoutSaved:!1,isMobileDevice:!1,mobilePagesNum:1,shareType:1,dataIsOk:!1,recordTime:5e3,intervalId:0,styleObj:{width:"100%",height:"100%"},bgColor:"",imgBase64:"",dashboardWidth:"",dashboardHeight:""}},computed:s()({canvasPositionClass:function(){if(this.isMobileDevice)return["mobileLayout"];var e=[];return this.screenWidth>this.dashboardWidth&&this.screenHeight>this.dashboardHeight?(e.push("allCenter"),e):(this.screenWidth>this.dashboardWidth&&e.push("aCenter"),this.screenHeight>this.dashboardHeight?e.push("vCenter"):e.push("overflowY"),e)}},Object(r.c)("main",{screenWidth:"getScreenWidth",screenHeight:"getScreenHeight"}),Object(r.c)("canvasPlace",{chartList:"getChartList",scaleLevel:"getScaleLevel",renderedChartCount:"getRenderedChartCount"}),Object(r.c)("config",{baseUrl:"baseUrl"}),{getChartList:function(){return this.isMobileDevice?this.chartListFilter:this.chartList},chartListFilter:function(){return this.chartList.filter(function(e){return e.containerOptions.showInMobileLayout&&e.containerStatus.isSetOptions})}}),watch:{dataIsOk:function(e){e&&document.dispatchEvent(new Event("render-active"))}},methods:{activateSocket:function(e){var t=this,i=new WebSocket("wss://socketbi.24e.co/");i.onopen=function(e){},i.onmessage=function(i){var a=JSON.parse(i.data);a.connectFd?(e.fd=a.connectFd,t.axios.get("https://pushbi.24e.co",{params:e}).then(function(e){})):t.$store.dispatch("canvasPlace/screeningRequest")}},getUrlParams:function(){var e=this,t={share_sn:e.$route.query.share_sn,password:e.$route.query.password},i=e.baseUrl+"api/shareInfo";e.axios.get(i,{params:t}).then(function(t){var i=t.data;if(e.bgColor=i.data.dashboardBgColor||"#0b0e14",e.imgBase64=i.data.dashboardBgImage,e.dashboardHeight=i.data.dashboardHeight,e.dashboardWidth=i.data.dashboardWidth,"000000"==i.code){if(i.data.pushInfo.pushState&&e.activateSocket({product_sn:i.data.project_sn,time:i.data.pushInfo.pushTime}),e.dataIsOk=!0,document.title=i.data.project_name,e.isMobileLayoutSaved=i.data.isMobileLayoutSaved,e.shareType=i.data.share_type,e.$store.commit("canvasPlace/clearArrChart"),!e.chartList.length){var a=i.data.share_info;a.length?a.forEach(function(t,i){var a=t.containerOptions;t.containerOptions.chartsType.split("-")[0];2==e.shareType&&(a.xPosition=0,a.yPosition=0);var n={id:i,containerOptions:a,containerStatus:{isSetOptions:!0,dataDimensionShow:!1,isDeleted:!1,isShowLoading:!1}},o=Object(l.a)(t).renderOptions;e.$set(n,"renderOptions",o),e.$store.commit("canvasPlace/setChartList",n)}):e.dataIsOk=!0}}else e.dataIsOk=!0,e.tips.show([i.err_msg])}).catch(function(t){e.dataIsOk=!0})},recordShareTime:function(){var e=this,t=e.baseUrl+"api/recordShare",i=e.$route.query.share_sn,a=e.$route.query.func||"",n=setInterval(function(){a?clearInterval(n):e.axios.get(t+"?share_sn="+i).then(function(t){"000000"!=t.data.code&&e.tips.show([t.data.err_msg])}).catch(function(e){})},5e3)}},beforeMount:function(){this.isMobileDevice=null!=navigator.userAgent.toLowerCase().match(/(ipod|iphone|android|coolpad|mmp|smartphone|midp|wap|xoom|symbian|j2me|blackberry|wince)/i)},mounted:function(){var e=this;e.getUrlParams(),e.recordShareTime(),setTimeout(function(){if(e.isMobileDevice){document.querySelector("html").style.overflow="auto";var t=e.chartListFilter.map(function(e){return Number(e.containerOptions.yPositionMobile)+Number(e.containerOptions.tableHeightMobile)}),i=t.length?Math.max.apply(Math,n()(t)):1;e.mobilePagesNum=i>1?Math.ceil(i/e.screenHeight):1}},1e3)}}),b={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wrapper",class:e.canvasPositionClass,style:{backgroundColor:e.bgColor,backgroundImage:"url("+e.imgBase64+")",height:e.isMobileDevice?100*e.mobilePagesNum+"vh":e.dashboardHeight+"px",width:e.isMobileDevice?"100vw":e.dashboardWidth+"px"}},[e.isMobileDevice&&!e.dataIsOk?i("loading-rotating",{attrs:{styleObj:e.styleObj}}):e._e(),e._v(" "),e.isMobileDevice?e._e():i("Loading",{attrs:{dataIsOk:e.dataIsOk,styleObj:e.styleObj}}),e._v(" "),e._l(e.getChartList,function(t,a){return i("div",{key:a,staticClass:"component-container",style:{width:e.isMobileDevice?Number(t.containerOptions.tableWidthMobile*e.screenWidth)+"px":Number(t.containerOptions.tableWidth)+"px",height:e.isMobileDevice?Number(t.containerOptions.tableHeightMobile)+"px":Number(t.containerOptions.tableHeight)+"px",left:(e.isMobileDevice?Number(t.containerOptions.xPositionMobile):Number(t.containerOptions.xPosition))+"px",top:(e.isMobileDevice?Number(t.containerOptions.yPositionMobile):Number(t.containerOptions.yPosition))+"px",position:e.isMobileLayoutSaved||!e.isMobileDevice?"absolute":"static",float:e.isMobileLayoutSaved?"usnet":"left",zIndex:Number(t.containerOptions.level)||0}},[i(t.containerOptions.chartsType,{tag:"component",style:{"z-index":t.containerOptions.level+3||3},attrs:{chartIndex:a,options:t.renderOptions,containerOptions:t.containerOptions,containerStatus:t.containerStatus,isSetOptions:t.containerStatus.isSetOptions}})],1)})],2)},staticRenderFns:[]};var p=i("VU/8")(u,b,!1,function(e){i("KRzv")},"data-v-5fbf3c6f",null);t.default=p.exports}});